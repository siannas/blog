import{u as he,_ as me,a as ge}from"./PoFMXOAe.js";import{D as R,A as B,M as ye,N as q,v as T,x as y,O as ne,Q as P,R as be,S as we,k as g,T as Se,U,m as D,V as ke,G as se,W as A,X as xe,Y as _e,Z as Ee,$ as Me,a0 as ce,p as de,I as Le,a1 as re,a2 as Te,a3 as Oe,c as k,b as F,a as w,a4 as De,d as Re,F as le,j as ae,a5 as X,o as x,a6 as Ce}from"./QrSXNkyt.js";import{_ as Ie}from"./6g_ULDXu.js";const j=Se?window:void 0;function W(e){var o;const n=y(e);return(o=n?.$el)!=null?o:n}function G(...e){const o=[],n=()=>{o.forEach(t=>t()),o.length=0},d=(t,r,i,s)=>(t.addEventListener(r,i,s),()=>t.removeEventListener(r,i,s)),c=T(()=>{const t=P(y(e[0])).filter(r=>r!=null);return t.every(r=>typeof r!="string")?t:void 0}),f=be(()=>{var t,r;return[(r=(t=c.value)==null?void 0:t.map(i=>W(i)))!=null?r:[j].filter(i=>i!=null),P(y(c.value?e[1]:e[0])),P(g(c.value?e[2]:e[1])),y(c.value?e[3]:e[2])]},([t,r,i,s])=>{if(n(),!t?.length||!r?.length||!i?.length)return;const h=we(s)?{...s}:s;o.push(...t.flatMap(a=>r.flatMap(p=>i.map(l=>d(a,p,l,h)))))},{flush:"post"}),v=()=>{f(),n()};return q(n),v}function Ne(){const e=R(!1),o=Le();return o&&de(()=>{e.value=!0},o),e}function fe(e){const o=Ne();return T(()=>(o.value,!!e()))}function We(e,o,n={}){const{window:d=j,...c}=n;let f;const v=fe(()=>d&&"MutationObserver"in d),t=()=>{f&&(f.disconnect(),f=void 0)},r=T(()=>{const a=y(e),p=P(a).map(W).filter(ce);return new Set(p)}),i=B(r,a=>{t(),v.value&&a.size&&(f=new MutationObserver(o),a.forEach(p=>f.observe(p,c)))},{immediate:!0,flush:"post"}),s=()=>f?.takeRecords(),h=()=>{i(),t()};return q(h),{isSupported:v,stop:h,takeRecords:s}}function Ve(e,o,n={}){const{root:d,rootMargin:c="0px",threshold:f=0,window:v=j,immediate:t=!0}=n,r=fe(()=>v&&"IntersectionObserver"in v),i=T(()=>{const l=y(e);return P(l).map(W).filter(ce)});let s=A;const h=R(t),a=r.value?B(()=>[i.value,W(d),h.value],([l,b])=>{if(s(),!h.value||!l.length)return;const m=new IntersectionObserver(o,{root:W(b),rootMargin:c,threshold:f});l.forEach(S=>S&&m.observe(S)),s=()=>{m.disconnect(),s=A}},{immediate:t,flush:"post"}):A,p=()=>{s(),a(),h.value=!1};return q(p),{isSupported:r,isActive:h,pause(){s(),h.value=!1},resume(){h.value=!0},stop:p}}function He(e,o={}){const{window:n=j,scrollTarget:d,threshold:c=0,rootMargin:f,once:v=!1}=o,t=R(!1),{stop:r}=Ve(e,i=>{let s=t.value,h=0;for(const a of i)a.time>=h&&(h=a.time,s=a.isIntersecting);t.value=s,v&&Ee(t,()=>{r()})},{root:d,window:n,threshold:c,rootMargin:y(f)});return t}function $(e){return typeof Window<"u"&&e instanceof Window?e.document.documentElement:typeof Document<"u"&&e instanceof Document?e.documentElement:e}const ie=1;function Pe(e,o={}){const{throttle:n=0,idle:d=200,onStop:c=A,onScroll:f=A,offset:v={left:0,right:0,top:0,bottom:0},observe:t={mutation:!1},eventListenerOptions:r={capture:!1,passive:!0},behavior:i="auto",window:s=j,onError:h=u=>{console.error(u)}}=o,a=typeof t=="boolean"?{mutation:t}:t,p=R(0),l=R(0),b=T({get(){return p.value},set(u){S(u,void 0)}}),m=T({get(){return l.value},set(u){S(void 0,u)}});function S(u,C){var _,V,H,Y;if(!s)return;const M=y(e);if(!M)return;(H=M instanceof Document?s.document.body:M)==null||H.scrollTo({top:(_=y(C))!=null?_:m.value,left:(V=y(u))!=null?V:b.value,behavior:y(i)});const O=((Y=M?.document)==null?void 0:Y.documentElement)||M?.documentElement||M;b!=null&&(p.value=O.scrollLeft),m!=null&&(l.value=O.scrollTop)}const N=R(!1),E=U({left:!0,right:!1,top:!0,bottom:!1}),L=U({left:!1,right:!1,top:!1,bottom:!1}),Z=u=>{N.value&&(N.value=!1,L.left=!1,L.right=!1,L.top=!1,L.bottom=!1,c(u))},pe=Me(Z,n+d),z=u=>{var C;if(!s)return;const _=((C=u?.document)==null?void 0:C.documentElement)||u?.documentElement||W(u),{display:V,flexDirection:H,direction:Y}=getComputedStyle(_),M=Y==="rtl"?-1:1,O=_.scrollLeft;L.left=O<p.value,L.right=O>p.value;const K=Math.abs(O*M)<=(v.left||0),ee=Math.abs(O*M)+_.clientWidth>=_.scrollWidth-(v.right||0)-ie;V==="flex"&&H==="row-reverse"?(E.left=ee,E.right=K):(E.left=K,E.right=ee),p.value=O;let I=_.scrollTop;u===s.document&&!I&&(I=s.document.body.scrollTop),L.top=I<l.value,L.bottom=I>l.value;const te=Math.abs(I)<=(v.top||0),oe=Math.abs(I)+_.clientHeight>=_.scrollHeight-(v.bottom||0)-ie;V==="flex"&&H==="column-reverse"?(E.top=oe,E.bottom=te):(E.top=te,E.bottom=oe),l.value=I},J=u=>{var C;if(!s)return;const _=(C=u.target.documentElement)!=null?C:u.target;z(_),N.value=!0,pe(u),f(u)};return G(e,"scroll",n?xe(J,n,!0,!1):J,r),_e(()=>{try{const u=y(e);if(!u)return;z(u)}catch(u){h(u)}}),a?.mutation&&e!=null&&e!==s&&e!==document&&We(e,()=>{const u=y(e);u&&z(u)},{attributes:!0,childList:!0,subtree:!0}),G(e,"scrollend",Z,r),{x:b,y:m,isScrolling:N,arrivedState:E,directions:L,measure(){const u=y(e);s&&u&&z(u)}}}function ue(e,o,n={}){var d;const{direction:c="bottom",interval:f=100,canLoadMore:v=()=>!0}=n,t=U(Pe(e,{...n,offset:{[c]:(d=n.distance)!=null?d:0,...n.offset}})),r=D(),i=T(()=>!!r.value),s=T(()=>$(y(e))),h=He(s);function a(){if(t.measure(),!s.value||!h.value||!v(s.value))return;const{scrollHeight:l,clientHeight:b,scrollWidth:m,clientWidth:S}=s.value,N=c==="bottom"||c==="top"?l<=b:m<=S;(t.arrivedState[c]||N)&&(r.value||(r.value=Promise.all([o(t),new Promise(E=>setTimeout(E,f))]).finally(()=>{r.value=null,se(()=>a())})))}const p=B(()=>[t.arrivedState[c],h.value],a,{immediate:!0});return ke(p),{isLoading:i,reset(){se(()=>a())}}}const Ae={mounted(e,o){typeof o.value=="function"?ue(e,o.value):ue(e,...o.value)}};function ve(e){const o=window.getComputedStyle(e);if(o.overflowX==="scroll"||o.overflowY==="scroll"||o.overflowX==="auto"&&e.clientWidth<e.scrollWidth||o.overflowY==="auto"&&e.clientHeight<e.scrollHeight)return!0;{const n=e.parentNode;return!n||n.tagName==="BODY"?!1:ve(n)}}function Be(e){const o=e||window.event,n=o.target;return ve(n)?!1:o.touches.length>1?!0:(o.preventDefault&&o.preventDefault(),!1)}const Q=new WeakMap;function je(e,o=!1){const n=R(o);let d=null,c="";B(ye(e),t=>{const r=$(y(t));if(r){const i=r;if(Q.get(i)||Q.set(i,i.style.overflow),i.style.overflow!=="hidden"&&(c=i.style.overflow),i.style.overflow==="hidden")return n.value=!0;if(n.value)return i.style.overflow="hidden"}},{immediate:!0});const f=()=>{const t=$(y(e));!t||n.value||(ne&&(d=G(t,"touchmove",r=>{Be(r)},{passive:!1})),t.style.overflow="hidden",n.value=!0)},v=()=>{const t=$(y(e));!t||!n.value||(ne&&d?.(),t.style.overflow=c,Q.delete(t),n.value=!1)};return q(v),T({get(){return n.value},set(t){t?f():v()}})}function ze(){let e=!1;const o=R(!1);return(n,d)=>{if(o.value=d.value,e)return;e=!0;const c=je(n,d.value);B(o,f=>c.value=f)}}ze();function Ye(){const e=D([]),o=D(0),n=D(!1),d=D(!1),c=D(!1),f=D([]),v=D(!1),t=async()=>{if(!(n.value||d.value)){d.value=!0,c.value=!1;try{const a=await re("notes").select("avatar","creator","title","description","path","meta","tags").order("path","DESC").limit(10).skip(o.value).all();return a&&a.length>0?(e.value.push(...a),o.value+=a.length):n.value=!0,a}catch(a){throw console.error("Error loading notes:",a),c.value=!0,a}finally{d.value=!1}}},r=async(a,p,l=[])=>{if((!a||a.trim()==="")&&l.length===0)return f.value=[],[];v.value=!0;try{const b=await p(a,l),m=await Promise.all(b.map(async S=>re("notes").select("avatar","creator","title","description","path","meta").path(S.path).first()));return f.value=m,m}catch(b){throw console.error("Search error:",b),f.value=[],b}finally{v.value=!1}},i=()=>{e.value=[],o.value=0,n.value=!1,d.value=!1,c.value=!1};return{items:e,skip:o,isEnd:n,isLoading:d,hasError:c,searchResults:f,isSearching:v,loadNotes:t,performSearch:r,reset:i,resetSearch:()=>{f.value=[]},initialize:async()=>{i(),await t()}}}const Fe={class:"bg-main min-h-screen"},Xe={class:"max-w-4xl mx-auto px-4 py-8"},$e={key:0},qe={class:"grid grid-cols-1 gap-6"},Qe={key:1,class:"text-center py-8"},Ue={key:2,class:"flex justify-center py-8"},Ge={key:3},Ze={class:"grid grid-cols-1 gap-6"},Je={key:0,class:"flex justify-center py-8"},Ke={key:1,class:"text-center py-8"},et={key:2,class:"text-center py-8 text-gray-500"},tt={key:3,class:"text-center py-8"},rt={__name:"index",setup(e){const o=Te(),n=Oe(),{items:d,isEnd:c,isLoading:f,hasError:v,loadNotes:t,resetSearch:r,initialize:i}=Ye(),s=he(),h=()=>{r();const p={...o.query};delete p.tag,n.replace({query:p})},a=p=>{};return de(async()=>{if(await i(),o.query.tag){const p=o.query.tag.split(",");s.updateSelectedTags(p)}}),(p,l)=>{const b=ge;return x(),k("div",Fe,[F(Ie),w("div",Xe,[F(me),g(s).searchResults?.value&&g(s).searchResults.value.length>0?(x(),k("div",$e,[w("div",{class:"flex justify-between items-center mb-6"},[l[2]||(l[2]=w("h2",{class:"text-2xl font-bold text-white"}," Search Results ",-1)),w("button",{class:"text-purple-400 hover:text-purple-300 flex items-center",onClick:h},[...l[1]||(l[1]=[w("svg",{class:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[w("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),Re(" Back to all notes ",-1)])])]),w("div",qe,[(x(!0),k(le,null,ae(g(s).searchResults.value,(m,S)=>(x(),k("div",{key:S,class:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700 hover:border-purple-500 transition-all duration-300 shadow-lg hover:shadow-xl"},[F(b,{title:m.title,description:m.description,path:m.path,tags:m.tags,position:"horizontal",onTagClicked:a},null,8,["title","description","path","tags"])]))),128))])])):g(s).searchQuery?.value&&!g(s).isSearching?.value?(x(),k("div",Qe,[...l[3]||(l[3]=[w("p",{class:"text-gray-400"},"No notes found matching your search criteria.",-1)])])):g(s).isSearching?.value?(x(),k("div",Ue,[...l[4]||(l[4]=[w("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"},null,-1)])])):De((x(),k("div",Ge,[w("div",Ze,[(x(!0),k(le,null,ae(g(d),(m,S)=>(x(),k("div",{key:S,class:"bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 border border-gray-700 hover:border-purple-500 transition-all duration-300 shadow-lg hover:shadow-xl"},[F(b,Ce({ref_for:!0},m,{position:"horizontal",onTagClicked:a}),null,16)]))),128))]),g(f)?(x(),k("div",Je,[...l[5]||(l[5]=[w("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500"},null,-1)])])):X("",!0),g(v)?(x(),k("div",Ke,[l[6]||(l[6]=w("p",{class:"text-red-500"},"Failed to load more notes. Please try again.",-1)),w("button",{class:"mt-4 px-4 py-2 bg-purple-700 text-white rounded hover:bg-purple-800 transition-colors",onClick:l[0]||(l[0]=(...m)=>g(t)&&g(t)(...m))}," Retry ")])):X("",!0),g(c)&&g(d).length>0?(x(),k("div",et,[...l[7]||(l[7]=[w("p",null,"You've reached the end of the notes.",-1)])])):X("",!0),g(c)&&g(d).length===0&&!g(f)?(x(),k("div",tt,[...l[8]||(l[8]=[w("p",null,"No notes found.",-1)])])):X("",!0)])),[[g(Ae),g(t)]])])])}}};export{rt as default};
